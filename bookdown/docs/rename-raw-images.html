<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning</title>
  <meta name="description" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  
  
  

<meta name="author" content="Henry Sun, Biniam Garomsa, Hector Ontiveros" />


<meta name="date" content="2022-07-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="selecting-region-of-interest.html"/>
<script src="book_assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="book_assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="book_assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="book_assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.1</b> About This Book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#introduction-1"><i class="fa fa-check"></i><b>1.2</b> Introduction</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.3</b> How to Use This Book</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#data-pipeline-overview"><i class="fa fa-check"></i><b>1.4</b> Data Pipeline Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rename-raw-images.html"><a href="rename-raw-images.html"><i class="fa fa-check"></i><b>2</b> Rename Raw Images</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#google-drive-files"><i class="fa fa-check"></i><b>2.1</b> Google Drive Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#load-packages"><i class="fa fa-check"></i><b>2.1.1</b> Load Packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="rename-raw-images.html"><a href="rename-raw-images.html#mount-google-drive"><i class="fa fa-check"></i><b>2.1.2</b> Mount Google Drive</a></li>
<li class="chapter" data-level="2.1.3" data-path="rename-raw-images.html"><a href="rename-raw-images.html#copying-files"><i class="fa fa-check"></i><b>2.1.3</b> Copying Files</a></li>
<li class="chapter" data-level="2.1.4" data-path="rename-raw-images.html"><a href="rename-raw-images.html#renaming-files"><i class="fa fa-check"></i><b>2.1.4</b> Renaming Files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rename-raw-images.html"><a href="rename-raw-images.html#local-files"><i class="fa fa-check"></i><b>2.2</b> Local Files</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#load-packages-1"><i class="fa fa-check"></i><b>2.2.1</b> Load Packages</a></li>
<li class="chapter" data-level="2.2.2" data-path="rename-raw-images.html"><a href="rename-raw-images.html#copying-files-1"><i class="fa fa-check"></i><b>2.2.2</b> Copying Files</a></li>
<li class="chapter" data-level="2.2.3" data-path="rename-raw-images.html"><a href="rename-raw-images.html#renaming-files-1"><i class="fa fa-check"></i><b>2.2.3</b> Renaming Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html"><i class="fa fa-check"></i><b>3</b> Selecting Region of Interest</a>
<ul>
<li class="chapter" data-level="3.1" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#using-the-script"><i class="fa fa-check"></i><b>3.1</b> Using the Script</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#import-packages"><i class="fa fa-check"></i><b>3.1.1</b> Import Packages</a></li>
<li class="chapter" data-level="3.1.2" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#set-folder-path"><i class="fa fa-check"></i><b>3.1.2</b> Set Folder Path</a></li>
<li class="chapter" data-level="3.1.3" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#drawing-rois"><i class="fa fa-check"></i><b>3.1.3</b> Drawing ROIs</a></li>
<li class="chapter" data-level="3.1.4" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#output"><i class="fa fa-check"></i><b>3.1.4</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#roipoly-functionalities"><i class="fa fa-check"></i><b>3.2</b> RoiPoly Functionalities</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#imagefile-class"><i class="fa fa-check"></i><b>3.2.1</b> ImageFile Class</a></li>
<li class="chapter" data-level="3.2.2" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#first-roi-and-masking-function"><i class="fa fa-check"></i><b>3.2.2</b> First ROI and Masking Function</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#documentation"><i class="fa fa-check"></i><b>3.3</b> Documentation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html"><i class="fa fa-check"></i><b>4</b> Classifying Image Attributes with VIA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html#creating-project"><i class="fa fa-check"></i><b>4.1</b> Creating Project</a></li>
<li class="chapter" data-level="4.2" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html#creating-attributes"><i class="fa fa-check"></i><b>4.2</b> Creating Attributes</a></li>
<li class="chapter" data-level="4.3" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html#classify-pixels"><i class="fa fa-check"></i><b>4.3</b> Classify Pixels</a></li>
<li class="chapter" data-level="4.4" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html#for-hubbard-brook-users"><i class="fa fa-check"></i><b>4.4</b> For Hubbard Brook Users</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html"><i class="fa fa-check"></i><b>5</b> Random Forest Image Classification</a>
<ul>
<li class="chapter" data-level="5.1" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#introduction-to-random-forest"><i class="fa fa-check"></i><b>5.1</b> Introduction to Random Forest</a></li>
<li class="chapter" data-level="5.2" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#using-the-script-1"><i class="fa fa-check"></i><b>5.2</b> Using the Script</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#data-preparation"><i class="fa fa-check"></i><b>5.2.1</b> Data Preparation</a></li>
<li class="chapter" data-level="5.2.2" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>5.2.2</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="5.2.3" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#training-random-forest-model"><i class="fa fa-check"></i><b>5.2.3</b> Training Random Forest Model</a></li>
<li class="chapter" data-level="5.2.4" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#generating-reclassified-images"><i class="fa fa-check"></i><b>5.2.4</b> Generating Reclassified Images</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html#future-improvements"><i class="fa fa-check"></i><b>5.3</b> Future Improvements</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Guide to an Image Processing Pipeline for Classification with Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rename-raw-images" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Rename Raw Images<a href="rename-raw-images.html#rename-raw-images" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Renaming images is the first key step in this data processing pipeline. For our study, field camera traps in various watersheds at Hubbard Brook Experimental Forest took one photo each day over a time span of several years. The original file names were a non-descriptive series of numbers, following this step, they will contain information about the watershed the photo was taken at as well as time-series image metadata.</p>
<p>These steps were designed to process files stored in a shared Google Drive by
running the script in <em>Google Colaboratory</em>. Before renaming images contained in a local directory, a few modifications to the script will need to be made; however, the same general principles will still apply. For instructions on running the script on files on your local computer rather than in Google Drive, see <strong>Section 1.2</strong>.</p>
<div id="google-drive-files" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Google Drive Files<a href="rename-raw-images.html#google-drive-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-packages" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Load Packages<a href="rename-raw-images.html#load-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before each session, first run the top 3 lines – these lines of code install the <em>Tesseract Optical Character Recognition Engine</em>, which allows us to later use the <code>text_to_string</code> function and read the timestamp from each image. Subsequently, load all required packages/libraries.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="rename-raw-images.html#cb1-1" aria-hidden="true" tabindex="-1"></a>apt install tesseract<span class="op">-</span>ocr</span>
<span id="cb1-2"><a href="rename-raw-images.html#cb1-2" aria-hidden="true" tabindex="-1"></a>apt install libtesseract<span class="op">-</span>dev</span>
<span id="cb1-3"><a href="rename-raw-images.html#cb1-3" aria-hidden="true" tabindex="-1"></a>pip install pytesseract</span>
<span id="cb1-4"><a href="rename-raw-images.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="rename-raw-images.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="rename-raw-images.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="rename-raw-images.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-8"><a href="rename-raw-images.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-9"><a href="rename-raw-images.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-10"><a href="rename-raw-images.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb1-11"><a href="rename-raw-images.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span></code></pre></div>
</div>
<div id="mount-google-drive" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Mount Google Drive<a href="rename-raw-images.html#mount-google-drive" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="rename-raw-images.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will connect to your Google Drive. It will ask you to allow access</span></span>
<span id="cb2-2"><a href="rename-raw-images.html#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/drive&#39;</span>, force_remount<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>When using Google Colaboratory, before performing any file operations, you must <em>mount</em> your personal Google Drive. Find the code chunk with the above code in Colab and run it to allow access.</p>
<p>Afterwards, make sure all file paths used in any functions are for your Google Drive specifically. To find a pathname, click the orange file icon on Google Colab’s sidebar, and then click content to navigate your Google Drive. Right-click and select copy path to copy the pathname (see below).</p>
<p><img src="imgs/contentdrive.png" width="322" /></p>
</div>
<div id="copying-files" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Copying Files<a href="rename-raw-images.html#copying-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This preliminary step is used when a backup or copy of the original data is needed. It will copy all files in the source directory not present in the target directory.</p>
<p>This method uses shutil’s <code>copytree</code> function, which blanket copies all files within a specified directory. To handle issues caused by direct copying of files versus copying of subdirectories, these are copied separate from each other within the code.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="rename-raw-images.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_files <span class="op">==</span> source_file_list: <span class="co"># Will copy entire source folder into destination when no subfolders/files are shared between the two</span></span>
<span id="cb3-2"><a href="rename-raw-images.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  shutil.copytree(source, destination <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> directory_name, ignore <span class="op">=</span> shutil.ignore_patterns(<span class="st">&#39;*.gdoc&#39;</span>, <span class="st">&#39;*.gsheet&#39;</span>, <span class="st">&#39;*.gslides&#39;</span>)) <span class="co">#1</span></span>
<span id="cb3-3"><a href="rename-raw-images.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="rename-raw-images.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-5"><a href="rename-raw-images.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> missing_files: <span class="co"># Will copy all missing files/subfolders not present in the destination</span></span>
<span id="cb3-6"><a href="rename-raw-images.html#cb3-6" aria-hidden="true" tabindex="-1"></a>      new_dst <span class="op">=</span> destination <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder</span>
<span id="cb3-7"><a href="rename-raw-images.html#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> os.path.isfile(folder) <span class="op">==</span> <span class="va">False</span>: <span class="co"># Copies all subfolders/subdirectories</span></span>
<span id="cb3-8"><a href="rename-raw-images.html#cb3-8" aria-hidden="true" tabindex="-1"></a>        shutil.copytree(source <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder, new_dst, ignore <span class="op">=</span> shutil.ignore_patterns(<span class="st">&#39;*.gdoc&#39;</span>, <span class="st">&#39;*.gsheet&#39;</span>, <span class="st">&#39;*.gslides&#39;</span>)) <span class="co">#1</span></span>
<span id="cb3-9"><a href="rename-raw-images.html#cb3-9" aria-hidden="true" tabindex="-1"></a>        missing_files.remove(folder)</span>
<span id="cb3-10"><a href="rename-raw-images.html#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>: <span class="co"># Copies files not contained within a subdirectory</span></span>
<span id="cb3-11"><a href="rename-raw-images.html#cb3-11" aria-hidden="true" tabindex="-1"></a>        shutil.copy(source <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder, destination)</span>
<span id="cb3-12"><a href="rename-raw-images.html#cb3-12" aria-hidden="true" tabindex="-1"></a>        missing_files.remove(folder) </span>
<span id="cb3-13"><a href="rename-raw-images.html#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;These folders/files were not copied (ignore if list is empty): &quot;</span>)</span>
<span id="cb3-14"><a href="rename-raw-images.html#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(missing_files)</span></code></pre></div>
<p>Copying <strong>any</strong> Google files, be it Google Docs, Slides, Sheets, Drawings, etc. must be done manually as these files are special and not able to be copied using shutil<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. For any additional file extensions to avoid copying, specify them as arguments for <code>shutil.ignore_patterns</code>.</p>
<div id="main-method" class="section level4 hasAnchor" number="2.1.3.1">
<h4><span class="header-section-number">2.1.3.1</span> Main Method<a href="rename-raw-images.html#main-method" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Finally, to copy the files, simply call <code>copy_files</code> within the main method. This method takes 3 arguments – the file path for the source folder, the file path for the destination folder, and a folder name for the folder created if the source and destination directories share no files.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="rename-raw-images.html#cb4-1" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> (<span class="st">&quot;/content/drive/MyDrive/Duke 2022-2023/Data+/2_Camera Trap photos/Stream Photos/On_Deck&quot;</span>, <span class="st">&quot;/content/drive/MyDrive/Duke 2022-2023/Data+/2_Camera Trap photos/COPY of data for script/On_Deck&quot;</span>, <span class="st">&quot;Newly_uploaded_data&quot;</span>)</span>
<span id="cb4-2"><a href="rename-raw-images.html#cb4-2" aria-hidden="true" tabindex="-1"></a>copy_files(<span class="op">*</span>args)</span></code></pre></div>
</div>
</div>
<div id="renaming-files" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Renaming Files<a href="rename-raw-images.html#renaming-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The renaming files script takes advantage of the <strong>Tesseract OCR Engine</strong> to read
the time stamp on the image. This string is then parsed to generate time series information. There are many complementary methods in this script; for more information, see documentation within the script itself.</p>
<p>Be sure to allocate time for the script to run, especially on folders containing
large amounts of image files<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>The pixel parameters within <code>extract_timeStamp</code> are designed for the images taken by the Bushnell field cameras used in our study.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="rename-raw-images.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_timeStamp(pic_address):</span>
<span id="cb5-2"><a href="rename-raw-images.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb5-3"><a href="rename-raw-images.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract time Stamp from picture file.</span></span>
<span id="cb5-4"><a href="rename-raw-images.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="rename-raw-images.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    From the bottom right of each picture file, the time stamp is read as image using cv2. It is then converted to a string.</span></span>
<span id="cb5-6"><a href="rename-raw-images.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    text which is then checked for format and subsequently returned through match_date_format.</span></span>
<span id="cb5-7"><a href="rename-raw-images.html#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="rename-raw-images.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb5-9"><a href="rename-raw-images.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb5-10"><a href="rename-raw-images.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    pic_address : full source address of current picture file.</span></span>
<span id="cb5-11"><a href="rename-raw-images.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb5-12"><a href="rename-raw-images.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb5-13"><a href="rename-raw-images.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    match_date_format.group(0) : unaltered timeStamp from bottom of the photo as a string.</span></span>
<span id="cb5-14"><a href="rename-raw-images.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb5-15"><a href="rename-raw-images.html#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(pic_address)</span></span>
<span id="cb5-16"><a href="rename-raw-images.html#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="rename-raw-images.html#cb5-17" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(pic_address) <span class="co">#read as an image</span></span>
<span id="cb5-18"><a href="rename-raw-images.html#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="rename-raw-images.html#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if the timestamp is the correct format</span></span>
<span id="cb5-20"><a href="rename-raw-images.html#cb5-20" aria-hidden="true" tabindex="-1"></a>    date_pattern <span class="op">=</span> <span class="st">&quot;\d\d-\d\d-\d\d\d\d \d\d:\d\d:\d\d&quot;</span> <span class="co"># eg 12-12-2020 11:59:32</span></span>
<span id="cb5-21"><a href="rename-raw-images.html#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="rename-raw-images.html#cb5-22" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-23"><a href="rename-raw-images.html#cb5-23" aria-hidden="true" tabindex="-1"></a>    size_extension<span class="op">=</span><span class="dv">0</span></span>
<span id="cb5-24"><a href="rename-raw-images.html#cb5-24" aria-hidden="true" tabindex="-1"></a>    x,y,z <span class="op">=</span> np.shape(img)</span>
<span id="cb5-25"><a href="rename-raw-images.html#cb5-25" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (x<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb5-26"><a href="rename-raw-images.html#cb5-26" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> (y<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb5-27"><a href="rename-raw-images.html#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(x,y,z)</span></span>
<span id="cb5-28"><a href="rename-raw-images.html#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> loop<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb5-29"><a href="rename-raw-images.html#cb5-29" aria-hidden="true" tabindex="-1"></a>      ts <span class="op">=</span> img[<span class="dv">2352</span> <span class="op">-</span> size_extension:, <span class="dv">2000</span><span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb5-30"><a href="rename-raw-images.html#cb5-30" aria-hidden="true" tabindex="-1"></a>      text <span class="op">=</span> pytesseract.image_to_string(ts)</span>
<span id="cb5-31"><a href="rename-raw-images.html#cb5-31" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text)</span>
<span id="cb5-32"><a href="rename-raw-images.html#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb5-33"><a href="rename-raw-images.html#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb5-34"><a href="rename-raw-images.html#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb5-35"><a href="rename-raw-images.html#cb5-35" aria-hidden="true" tabindex="-1"></a>      ts_2 <span class="op">=</span> img[x <span class="op">-</span> size_extension:, x<span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb5-36"><a href="rename-raw-images.html#cb5-36" aria-hidden="true" tabindex="-1"></a>      text_2<span class="op">=</span> pytesseract.image_to_string(ts_2)</span>
<span id="cb5-37"><a href="rename-raw-images.html#cb5-37" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text_2)</span>
<span id="cb5-38"><a href="rename-raw-images.html#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb5-39"><a href="rename-raw-images.html#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb5-40"><a href="rename-raw-images.html#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb5-41"><a href="rename-raw-images.html#cb5-41" aria-hidden="true" tabindex="-1"></a>      size_extension<span class="op">+=</span><span class="dv">100</span></span>
<span id="cb5-42"><a href="rename-raw-images.html#cb5-42" aria-hidden="true" tabindex="-1"></a>      loop<span class="op">-=</span><span class="dv">1</span></span>
<span id="cb5-43"><a href="rename-raw-images.html#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="rename-raw-images.html#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loop <span class="op">==</span><span class="dv">0</span>:      </span>
<span id="cb5-45"><a href="rename-raw-images.html#cb5-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reached end of loop without finding correct timestamp</span></span>
<span id="cb5-46"><a href="rename-raw-images.html#cb5-46" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">&quot;Correct timestamp not found&quot;</span>)</span>
<span id="cb5-47"><a href="rename-raw-images.html#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="rename-raw-images.html#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-49"><a href="rename-raw-images.html#cb5-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> match_date_format.group(<span class="dv">0</span>)</span></code></pre></div>
<p>As with before, make sure Google Drive is mounted, and all relevant packages/libraries are imported. Then, update the file paths<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> and run the main method (below).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="rename-raw-images.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb6-2"><a href="rename-raw-images.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="rename-raw-images.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#collect all folder paths from newly uploaded data on folder</span></span>
<span id="cb6-4"><a href="rename-raw-images.html#cb6-4" aria-hidden="true" tabindex="-1"></a>folder_list <span class="op">=</span> glob(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/Newly_uploaded_data/*/&quot;</span>, recursive <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-5"><a href="rename-raw-images.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># collect all folder path from on deck folder</span></span>
<span id="cb6-6"><a href="rename-raw-images.html#cb6-6" aria-hidden="true" tabindex="-1"></a>folder_list.extend(glob(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/On_Deck/*/&quot;</span>, recursive <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb6-7"><a href="rename-raw-images.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract folder_name </span></span>
<span id="cb6-8"><a href="rename-raw-images.html#cb6-8" aria-hidden="true" tabindex="-1"></a>folder_list <span class="op">=</span> [f[:<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> f <span class="kw">in</span> folder_list]</span>
<span id="cb6-9"><a href="rename-raw-images.html#cb6-9" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-10"><a href="rename-raw-images.html#cb6-10" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/Testing destination/file_df.csv&quot;</span>)</span>
<span id="cb6-11"><a href="rename-raw-images.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="rename-raw-images.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># for each folder rename and add them to the new destination - dst</span></span>
<span id="cb6-13"><a href="rename-raw-images.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> folder <span class="kw">in</span> folder_list:</span>
<span id="cb6-14"><a href="rename-raw-images.html#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(i,<span class="st">&quot;/&quot;</span>, <span class="bu">len</span>(folder_list))</span>
<span id="cb6-15"><a href="rename-raw-images.html#cb6-15" aria-hidden="true" tabindex="-1"></a>  i<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb6-16"><a href="rename-raw-images.html#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># destination to save labeled images</span></span>
<span id="cb6-17"><a href="rename-raw-images.html#cb6-17" aria-hidden="true" tabindex="-1"></a>  dst <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/project_dir/labeled_image_files&quot;</span></span>
<span id="cb6-18"><a href="rename-raw-images.html#cb6-18" aria-hidden="true" tabindex="-1"></a>  save_as_zip <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-19"><a href="rename-raw-images.html#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="rename-raw-images.html#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#will unzip if necessary</span></span>
<span id="cb6-21"><a href="rename-raw-images.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  folder, unzipped <span class="op">=</span> unzip_src(folder)</span>
<span id="cb6-22"><a href="rename-raw-images.html#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="rename-raw-images.html#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># #create new destination folder</span></span>
<span id="cb6-24"><a href="rename-raw-images.html#cb6-24" aria-hidden="true" tabindex="-1"></a>  fdr_name, fdr_dst <span class="op">=</span> new_folder(folder, dst)</span>
<span id="cb6-25"><a href="rename-raw-images.html#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="rename-raw-images.html#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> os.path.exists(fdr_dst):</span>
<span id="cb6-27"><a href="rename-raw-images.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;path already exists&quot;</span>)</span>
<span id="cb6-28"><a href="rename-raw-images.html#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb6-29"><a href="rename-raw-images.html#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;new path&quot;</span>)</span>
<span id="cb6-30"><a href="rename-raw-images.html#cb6-30" aria-hidden="true" tabindex="-1"></a>    os.mkdir(fdr_dst)</span>
<span id="cb6-31"><a href="rename-raw-images.html#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(folder)</span>
<span id="cb6-32"><a href="rename-raw-images.html#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(fdr_name)</span>
<span id="cb6-33"><a href="rename-raw-images.html#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(fdr_dst)</span>
<span id="cb6-34"><a href="rename-raw-images.html#cb6-34" aria-hidden="true" tabindex="-1"></a>  rename_images(folder, fdr_name, fdr_dst, file_df <span class="op">=</span> file_df)</span></code></pre></div>
<p>The script generates a pandas dataframe which contains the old filename,
new filename, folder name containing the image, as well as the image <strong>status</strong> (whether or not it was renamed successfully). This dataframe is then exported to a <code>.csv</code> file in a user-specified destination. See below for an example.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="rename-raw-images.html#cb7-1" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.DataFrame(file_names_list, columns <span class="op">=</span> [<span class="st">&quot;old_name&quot;</span>, <span class="st">&quot;new_name&quot;</span>,<span class="st">&quot;status&quot;</span>, <span class="st">&quot;note&quot;</span>,<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb7-2"><a href="rename-raw-images.html#cb7-2" aria-hidden="true" tabindex="-1"></a>file_df.to_csv(dst<span class="op">+</span><span class="st">&quot;/&quot;</span><span class="op">+</span><span class="st">&quot;file_df.csv&quot;</span>)</span>
<span id="cb7-3"><a href="rename-raw-images.html#cb7-3" aria-hidden="true" tabindex="-1"></a>file_df.head()</span></code></pre></div>
<p><img src="imgs/dataframe.png" width="766" /></p>
<div id="manual-renames" class="section level4 hasAnchor" number="2.1.4.1">
<h4><span class="header-section-number">2.1.4.1</span> Manual Renames<a href="rename-raw-images.html#manual-renames" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>While this script works for the vast majority of images, occasionally some images
will fail to rename correctly. For any files where the timestamp generated a file name which does not match a valid date, run the below chunk of code to identify them.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="rename-raw-images.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in created csv, returns file name and path if extracted timestamp is not in range</span></span>
<span id="cb8-2"><a href="rename-raw-images.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="rename-raw-images.html#cb8-3" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/project_dir/labeled_image_files/file_df.csv&quot;</span>)</span>
<span id="cb8-4"><a href="rename-raw-images.html#cb8-4" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> file_df[file_df[<span class="st">&quot;new_name&quot;</span>].notnull()]</span>
<span id="cb8-5"><a href="rename-raw-images.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> file_df.iterrows():</span>
<span id="cb8-6"><a href="rename-raw-images.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check month range</span></span>
<span id="cb8-7"><a href="rename-raw-images.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">13</span>:<span class="dv">15</span>]) <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">13</span>:<span class="dv">15</span>]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb8-8"><a href="rename-raw-images.html#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Month not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb8-9"><a href="rename-raw-images.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check year range</span></span>
<span id="cb8-10"><a href="rename-raw-images.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">9</span>:<span class="dv">13</span>]) <span class="op">&gt;</span> <span class="dv">2022</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">9</span>:<span class="dv">13</span>]) <span class="op">&lt;</span> <span class="dv">2018</span>:</span>
<span id="cb8-11"><a href="rename-raw-images.html#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Year not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb8-12"><a href="rename-raw-images.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check day range</span></span>
<span id="cb8-13"><a href="rename-raw-images.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">15</span>:<span class="dv">17</span>]) <span class="op">&gt;</span> <span class="dv">31</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">15</span>:<span class="dv">17</span>]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb8-14"><a href="rename-raw-images.html#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Day not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span></code></pre></div>
<p>Another common occurrence is when the timestamp failed to generate altogether due
to <code>pytesseract.image_to_string</code> failing. This is sometimes unavoidable and requires manual renaming of the file. However, this should not be a frequent occurrence due to the built-in loop in <code>extract_timeStamp</code>.</p>
</div>
</div>
</div>
<div id="local-files" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Local Files<a href="rename-raw-images.html#local-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section covers how to run the <code>copy_files</code> method and <code>rename_script</code> script
on files contained in a local directory. This is <strong>especially</strong> relevant for users
aiming to rename images that are not from Hubbard Brook experimental forest, and/or
do not meet the specifications of our script (i.e the timestamp is located at a
different position on the image, or )</p>
<div id="load-packages-1" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Load Packages<a href="rename-raw-images.html#load-packages-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When using files on your local computer, first install <code>pytesseract</code> - documentation
and more information on how to do this is available <a href="https://pypi.org/project/pytesseract/">here</a>. Then, load all packages as needed.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="rename-raw-images.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytesseract</span>
<span id="cb9-2"><a href="rename-raw-images.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="rename-raw-images.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-4"><a href="rename-raw-images.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb9-5"><a href="rename-raw-images.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-6"><a href="rename-raw-images.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb9-7"><a href="rename-raw-images.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span></code></pre></div>
</div>
<div id="copying-files-1" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Copying Files<a href="rename-raw-images.html#copying-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>shutil</code> and <code>os</code> libraries can be used in the same manner on a local machine
as in Google Drive. Therefore, no modifications are required to run the <code>copy_files</code> method on local files on your computer. Refer to the instructions above in section <strong>1.1.3</strong>. Ensure the path arguments in the main method map to directories stored in your local machine.</p>
</div>
<div id="renaming-files-1" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Renaming Files<a href="rename-raw-images.html#renaming-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The script for renaming files is designed with Hubbard Brook images in mind. The format for an image’s new name is Hbwtr_<em>watershed number</em>_<em>date</em>_<em>time</em>.JPG.
The date and time elements are extracted from the image, whereas the watershed number
is part of the name of the source directory.</p>
<p>If you would like to follow a different naming convention, the below method must be
changed (<code>generate_picName</code>) to reflect that. For example, changing <code>new_name</code> to <code>"Watershed"ws_num +'_' + date + .'jpg'"</code> would output <em>Watershed9_12042020.jpg</em> for an image taken on December 4th, 2020 at Watershed no. 9.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="rename-raw-images.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_picName(fdr_name, tStamp):</span>
<span id="cb10-2"><a href="rename-raw-images.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  ws_num <span class="op">=</span> fdr_name[<span class="dv">1</span>] <span class="co">#!!!this should be changed if src_elements[-2][1] will not be watershed number!!</span></span>
<span id="cb10-3"><a href="rename-raw-images.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="rename-raw-images.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  stamp_elements <span class="op">=</span> re.split(<span class="st">&#39;[</span><span class="ch">\n</span><span class="st">: -]&#39;</span>, tStamp)</span>
<span id="cb10-5"><a href="rename-raw-images.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  date <span class="op">=</span> stamp_elements[<span class="dv">2</span>] <span class="op">+</span> stamp_elements[<span class="dv">0</span>] <span class="op">+</span> stamp_elements[<span class="dv">1</span>]</span>
<span id="cb10-6"><a href="rename-raw-images.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  time <span class="op">=</span> stamp_elements[<span class="dv">3</span>] <span class="op">+</span> stamp_elements[<span class="dv">4</span>] <span class="op">+</span> stamp_elements[<span class="dv">5</span>]</span>
<span id="cb10-7"><a href="rename-raw-images.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="rename-raw-images.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  new_name <span class="op">=</span> <span class="st">&quot;Hbwtr_w&quot;</span> <span class="op">+</span> ws_num <span class="op">+</span> <span class="st">&#39;_&#39;</span> <span class="op">+</span> date <span class="op">+</span> <span class="st">&#39;_&#39;</span> <span class="op">+</span> time <span class="op">+</span> <span class="st">&#39;.JPG&#39;</span></span>
<span id="cb10-9"><a href="rename-raw-images.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> new_name</span></code></pre></div>
<div id="changing-timestamp" class="section level4 hasAnchor" number="2.2.3.1">
<h4><span class="header-section-number">2.2.3.1</span> Changing Timestamp<a href="rename-raw-images.html#changing-timestamp" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The most complicated and error-prone step in the renaming process is extracting a timestamp. The way it is done in the current code is by starting with the pixel location of the timestamp, attempting to read the timestamp with <code>image_to_string</code>, and zooming out if the timestamp</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="rename-raw-images.html#cb11-1" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-2"><a href="rename-raw-images.html#cb11-2" aria-hidden="true" tabindex="-1"></a>    size_extension<span class="op">=</span><span class="dv">0</span></span>
<span id="cb11-3"><a href="rename-raw-images.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    x,y,z <span class="op">=</span> np.shape(img)</span>
<span id="cb11-4"><a href="rename-raw-images.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (x<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb11-5"><a href="rename-raw-images.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> (y<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb11-6"><a href="rename-raw-images.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(x,y,z)</span></span>
<span id="cb11-7"><a href="rename-raw-images.html#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> loop<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb11-8"><a href="rename-raw-images.html#cb11-8" aria-hidden="true" tabindex="-1"></a>      ts <span class="op">=</span> img[<span class="dv">2352</span> <span class="op">-</span> size_extension:, <span class="dv">2000</span><span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb11-9"><a href="rename-raw-images.html#cb11-9" aria-hidden="true" tabindex="-1"></a>      text <span class="op">=</span> pytesseract.image_to_string(ts)</span>
<span id="cb11-10"><a href="rename-raw-images.html#cb11-10" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text)</span>
<span id="cb11-11"><a href="rename-raw-images.html#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb11-12"><a href="rename-raw-images.html#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb11-13"><a href="rename-raw-images.html#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb11-14"><a href="rename-raw-images.html#cb11-14" aria-hidden="true" tabindex="-1"></a>      ts_2 <span class="op">=</span> img[x <span class="op">-</span> size_extension:, x<span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb11-15"><a href="rename-raw-images.html#cb11-15" aria-hidden="true" tabindex="-1"></a>      text_2<span class="op">=</span> pytesseract.image_to_string(ts_2)</span>
<span id="cb11-16"><a href="rename-raw-images.html#cb11-16" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text_2)</span>
<span id="cb11-17"><a href="rename-raw-images.html#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb11-18"><a href="rename-raw-images.html#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb11-19"><a href="rename-raw-images.html#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb11-20"><a href="rename-raw-images.html#cb11-20" aria-hidden="true" tabindex="-1"></a>      size_extension<span class="op">+=</span><span class="dv">100</span></span>
<span id="cb11-21"><a href="rename-raw-images.html#cb11-21" aria-hidden="true" tabindex="-1"></a>      loop<span class="op">-=</span><span class="dv">1</span></span>
<span id="cb11-22"><a href="rename-raw-images.html#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="rename-raw-images.html#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loop <span class="op">==</span><span class="dv">0</span>:      </span>
<span id="cb11-24"><a href="rename-raw-images.html#cb11-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reached end of loop without finding correct timestamp</span></span>
<span id="cb11-25"><a href="rename-raw-images.html#cb11-25" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">&quot;Correct timestamp not found&quot;</span>)</span></code></pre></div>
<p>Our script is only able to extract the timestamp if it is present within the image.
If the image you use does not contain any time-series data, we recommend removing the <code>extract_timeStamp</code> method and changing the file naming format to reflect that.</p>
<p>After these changes are made, the script should again function identically to
the one housed in Google Colab. Update the file path and run the main method to
rename your files.</p>
<p>The script will occasionally throw some unavoidable errors, such as the <code>image_to_string</code> method failing to extract a timestamp. To deal
with these fringe cases, see <strong>section 1.1.4.1</strong> (Manual Renames) above.</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>For more information, see the comments within the script and text blocks in the Jupyter Notebook.<a href="rename-raw-images.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>If you are looking to reduce the script’s runtime, one method is to remove the loop within <code>extract_timeStamp</code> which searches multiple times for the correct timestamp if it is not found initially. However, this will increase the number of files which failed to be renamed correctly.<a href="rename-raw-images.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>It may be a good idea to remove or make a note of any non-image files within the folder, as these will throw errors.<a href="rename-raw-images.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="selecting-region-of-interest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/henrysun9074/hbwater_cameratrap_pheno/edit/master/01-renamefiles.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/henrysun9074/hbwater_cameratrap_pheno/blob/master/01-renamefiles.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
