<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning</title>
  <meta name="description" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Rename Raw Images | A Guide to an Image Processing Pipeline for Classification with Machine Learning" />
  
  
  

<meta name="author" content="Henry Sun, Biniam Garomsa, Hector Ontiveros" />


<meta name="date" content="2022-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="selecting-region-of-interest.html"/>
<script src="book_assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="book_assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="book_assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="book_assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.1</b> About This Book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#load-packages"><i class="fa fa-check"></i><b>1.2</b> Load Packages</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#introduction-1"><i class="fa fa-check"></i><b>1.3</b> Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#data-pipeline-overview"><i class="fa fa-check"></i><b>1.4</b> Data Pipeline Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rename-raw-images.html"><a href="rename-raw-images.html"><i class="fa fa-check"></i><b>2</b> Rename Raw Images</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#mount-google-drive"><i class="fa fa-check"></i><b>2.0.1</b> Mount Google Drive</a></li>
<li class="chapter" data-level="2.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#copying-files"><i class="fa fa-check"></i><b>2.1</b> Copying Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#load-packages-1"><i class="fa fa-check"></i><b>2.1.1</b> Load Packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="rename-raw-images.html"><a href="rename-raw-images.html#copying-files-1"><i class="fa fa-check"></i><b>2.1.2</b> Copying Files</a></li>
<li class="chapter" data-level="2.1.3" data-path="rename-raw-images.html"><a href="rename-raw-images.html#main-method"><i class="fa fa-check"></i><b>2.1.3</b> Main Method</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rename-raw-images.html"><a href="rename-raw-images.html#renaming-files"><i class="fa fa-check"></i><b>2.2</b> Renaming Files</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rename-raw-images.html"><a href="rename-raw-images.html#manual-renames"><i class="fa fa-check"></i><b>2.2.1</b> Manual Renames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html"><i class="fa fa-check"></i><b>3</b> Selecting Region of Interest</a>
<ul>
<li class="chapter" data-level="3.1" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#roipoly-functionality"><i class="fa fa-check"></i><b>3.1</b> RoiPoly Functionality</a></li>
<li class="chapter" data-level="3.2" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#final-name-of-slide_through"><i class="fa fa-check"></i><b>3.2</b> final name of slide_through</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#preliminary-data-collection-information"><i class="fa fa-check"></i><b>3.2.1</b> Preliminary Data Collection Information</a></li>
<li class="chapter" data-level="3.2.2" data-path="selecting-region-of-interest.html"><a href="selecting-region-of-interest.html#plotting-masking-and-button-functionality"><i class="fa fa-check"></i><b>3.2.2</b> Plotting, Masking, and Button Functionality</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classifying-image-attributes-with-via.html"><a href="classifying-image-attributes-with-via.html"><i class="fa fa-check"></i><b>4</b> Classifying Image Attributes with VIA</a></li>
<li class="chapter" data-level="5" data-path="random-forest-image-classification.html"><a href="random-forest-image-classification.html"><i class="fa fa-check"></i><b>5</b> Random Forest Image Classification</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Guide to an Image Processing Pipeline for Classification with Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rename-raw-images" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Rename Raw Images<a href="rename-raw-images.html#rename-raw-images" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Renaming images is the first key step in this data processing pipeline. For our study, field camera traps in various watersheds at Hubbard Brook Experimental Forest took one photo each day over a timespan of several years. The original file names were a nondescriptive series of numbers,
following this step, they will contain information about the watershed the photo
was taken at as well as timeseries image metadata.</p>
<p>These steps were designed to process files stored in a shared Google Drive. Before renaming images contained in a local directory, modifications to the script will need to be made;
however, the same general principles will still apply.</p>
<div id="mount-google-drive" class="section level3 hasAnchor" number="2.0.1">
<h3><span class="header-section-number">2.0.1</span> Mount Google Drive<a href="rename-raw-images.html#mount-google-drive" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="rename-raw-images.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will connect to your Google Drive. It will ask you to allow access</span></span>
<span id="cb2-2"><a href="rename-raw-images.html#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/drive&#39;</span>, force_remount<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>When using Google Colaboratory, before performing any file operations, you must <em>mount</em> your personal Google Drive. Run the above code to allow access.</p>
<p>Afterwards, make sure all file paths used in any functions are for your Google Drive specifically. To find a pathname, click the orange file icon on Google Colab’s sidebar, and then click content to navigate your Google Drive. Right-click and select copy path to copy the pathname.</p>
<p><img src="imgs/contentdrive.png" width="322" /></p>
</div>
<div id="copying-files" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Copying Files<a href="rename-raw-images.html#copying-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This preliminary step is used when a backup or copy of the original data is needed. It will copy all files in the source directory not present in the target directory.</p>
<div id="load-packages-1" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Load Packages<a href="rename-raw-images.html#load-packages-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before each session, first run the top 3 lines – these lines of code install the <em>Tesseract Optical Character Recognition Engine</em>, which allows us to later use the <code>text_to_string</code> function and read the timestamp from each image. Subsequently, load all required packages/libraries.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="rename-raw-images.html#cb3-1" aria-hidden="true" tabindex="-1"></a>apt install tesseract<span class="op">-</span>ocr</span>
<span id="cb3-2"><a href="rename-raw-images.html#cb3-2" aria-hidden="true" tabindex="-1"></a>apt install libtesseract<span class="op">-</span>dev</span>
<span id="cb3-3"><a href="rename-raw-images.html#cb3-3" aria-hidden="true" tabindex="-1"></a>pip install pytesseract</span>
<span id="cb3-4"><a href="rename-raw-images.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="rename-raw-images.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="rename-raw-images.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-7"><a href="rename-raw-images.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-8"><a href="rename-raw-images.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-9"><a href="rename-raw-images.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb3-10"><a href="rename-raw-images.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb3-11"><a href="rename-raw-images.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span></code></pre></div>
</div>
<div id="copying-files-1" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Copying Files<a href="rename-raw-images.html#copying-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This method uses shutil’s <code>copytree</code> function, which blanket copies all files within a specified directory. To handle issues caused by direct copying of files versus copying of subdirectories, these are copied separate from each other within the code.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="rename-raw-images.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_files <span class="op">==</span> source_file_list: <span class="co"># Will copy entire source folder into destination when no subfolders/files are shared between the two</span></span>
<span id="cb4-2"><a href="rename-raw-images.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  shutil.copytree(source, destination <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> directory_name, ignore <span class="op">=</span> shutil.ignore_patterns(<span class="st">&#39;*.gdoc&#39;</span>, <span class="st">&#39;*.gsheet&#39;</span>, <span class="st">&#39;*.gslides&#39;</span>)) <span class="co">#1</span></span>
<span id="cb4-3"><a href="rename-raw-images.html#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="rename-raw-images.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-5"><a href="rename-raw-images.html#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> missing_files: <span class="co"># Will copy all missing files/subfolders not present in the destination</span></span>
<span id="cb4-6"><a href="rename-raw-images.html#cb4-6" aria-hidden="true" tabindex="-1"></a>      new_dst <span class="op">=</span> destination <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder</span>
<span id="cb4-7"><a href="rename-raw-images.html#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> os.path.isfile(folder) <span class="op">==</span> <span class="va">False</span>: <span class="co"># Copies all subfolders/subdirectories</span></span>
<span id="cb4-8"><a href="rename-raw-images.html#cb4-8" aria-hidden="true" tabindex="-1"></a>        shutil.copytree(source <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder, new_dst, ignore <span class="op">=</span> shutil.ignore_patterns(<span class="st">&#39;*.gdoc&#39;</span>, <span class="st">&#39;*.gsheet&#39;</span>, <span class="st">&#39;*.gslides&#39;</span>)) <span class="co">#1</span></span>
<span id="cb4-9"><a href="rename-raw-images.html#cb4-9" aria-hidden="true" tabindex="-1"></a>        missing_files.remove(folder)</span>
<span id="cb4-10"><a href="rename-raw-images.html#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>: <span class="co"># Copies files not contained within a subdirectory</span></span>
<span id="cb4-11"><a href="rename-raw-images.html#cb4-11" aria-hidden="true" tabindex="-1"></a>        shutil.copy(source <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> folder, destination)</span>
<span id="cb4-12"><a href="rename-raw-images.html#cb4-12" aria-hidden="true" tabindex="-1"></a>        missing_files.remove(folder) </span>
<span id="cb4-13"><a href="rename-raw-images.html#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;These folders/files were not copied (ignore if list is empty): &quot;</span>)</span>
<span id="cb4-14"><a href="rename-raw-images.html#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(missing_files)</span></code></pre></div>
<p>Copying <strong>any</strong> Google files, be it Google Docs, Slides, Sheets, Drawings, etc. must be done manually as these files are special and not able to be copied using shutil<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. For any additional file extensions to avoid copying, specify them as arguments for <code>shutil.ignore_patterns</code>.</p>
</div>
<div id="main-method" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Main Method<a href="rename-raw-images.html#main-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, to copy the files, simply call <code>copy_files</code> within the main method. This method takes 3 arguments – the file path for the source folder, the file path for the destination folder, and a folder name for the folder created if the source and destination directories share no files.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="rename-raw-images.html#cb5-1" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> (<span class="st">&quot;/content/drive/MyDrive/Duke 2022-2023/Data+/2_Camera Trap photos/Stream Photos/On_Deck&quot;</span>, <span class="st">&quot;/content/drive/MyDrive/Duke 2022-2023/Data+/2_Camera Trap photos/COPY of data for script/On_Deck&quot;</span>, <span class="st">&quot;Newly_uploaded_data&quot;</span>)</span>
<span id="cb5-2"><a href="rename-raw-images.html#cb5-2" aria-hidden="true" tabindex="-1"></a>copy_files(<span class="op">*</span>args)</span></code></pre></div>
</div>
</div>
<div id="renaming-files" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Renaming Files<a href="rename-raw-images.html#renaming-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The renaming files script takes advantage of the <strong>Tesseract OCR Engine</strong> to extract
the timestamp from the image. This string is then parsed to generate time series
information. There are many complementary methods in this script; for more information,
see documentation within the script itself.</p>
<p>Be sure to allocate time for the script to run, especially on folders containing
large amounts of image files<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Additionally, the pixel parameters within <code>extract_timeStamp</code> are designed for
the images taken by the field cameras used in our study. These will have to be
<em>adjusted</em> for images with time series information contained elsewhere.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="rename-raw-images.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_timeStamp(pic_address):</span>
<span id="cb6-2"><a href="rename-raw-images.html#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb6-3"><a href="rename-raw-images.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract time Stamp from picture file.</span></span>
<span id="cb6-4"><a href="rename-raw-images.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="rename-raw-images.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    From the bottom right of each picture file, the time stamp is read as image using cv2. It is then converted to a string.</span></span>
<span id="cb6-6"><a href="rename-raw-images.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    text which is then checked for format and subsequently returned through match_date_format.</span></span>
<span id="cb6-7"><a href="rename-raw-images.html#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="rename-raw-images.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb6-9"><a href="rename-raw-images.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb6-10"><a href="rename-raw-images.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    pic_address : full source address of current picture file.</span></span>
<span id="cb6-11"><a href="rename-raw-images.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb6-12"><a href="rename-raw-images.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb6-13"><a href="rename-raw-images.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">    match_date_format.group(0) : unaltered timeStamp from bottom of the photo as a string.</span></span>
<span id="cb6-14"><a href="rename-raw-images.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb6-15"><a href="rename-raw-images.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(pic_address)</span></span>
<span id="cb6-16"><a href="rename-raw-images.html#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="rename-raw-images.html#cb6-17" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(pic_address) <span class="co">#read as an image</span></span>
<span id="cb6-18"><a href="rename-raw-images.html#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="rename-raw-images.html#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if the timestamp is the correct format</span></span>
<span id="cb6-20"><a href="rename-raw-images.html#cb6-20" aria-hidden="true" tabindex="-1"></a>    date_pattern <span class="op">=</span> <span class="st">&quot;\d\d-\d\d-\d\d\d\d \d\d:\d\d:\d\d&quot;</span> <span class="co"># eg 12-12-2020 11:59:32</span></span>
<span id="cb6-21"><a href="rename-raw-images.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="rename-raw-images.html#cb6-22" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-23"><a href="rename-raw-images.html#cb6-23" aria-hidden="true" tabindex="-1"></a>    size_extension<span class="op">=</span><span class="dv">0</span></span>
<span id="cb6-24"><a href="rename-raw-images.html#cb6-24" aria-hidden="true" tabindex="-1"></a>    x,y,z <span class="op">=</span> np.shape(img)</span>
<span id="cb6-25"><a href="rename-raw-images.html#cb6-25" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (x<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb6-26"><a href="rename-raw-images.html#cb6-26" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> (y<span class="op">//</span><span class="dv">1000</span>)<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb6-27"><a href="rename-raw-images.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(x,y,z)</span></span>
<span id="cb6-28"><a href="rename-raw-images.html#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> loop<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb6-29"><a href="rename-raw-images.html#cb6-29" aria-hidden="true" tabindex="-1"></a>      ts <span class="op">=</span> img[<span class="dv">2352</span> <span class="op">-</span> size_extension:, <span class="dv">2000</span><span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb6-30"><a href="rename-raw-images.html#cb6-30" aria-hidden="true" tabindex="-1"></a>      text <span class="op">=</span> pytesseract.image_to_string(ts)</span>
<span id="cb6-31"><a href="rename-raw-images.html#cb6-31" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text)</span>
<span id="cb6-32"><a href="rename-raw-images.html#cb6-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb6-33"><a href="rename-raw-images.html#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb6-34"><a href="rename-raw-images.html#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb6-35"><a href="rename-raw-images.html#cb6-35" aria-hidden="true" tabindex="-1"></a>      ts_2 <span class="op">=</span> img[x <span class="op">-</span> size_extension:, x<span class="op">-</span>size_extension:, :] <span class="co">#(change if sizing conventions change!)</span></span>
<span id="cb6-36"><a href="rename-raw-images.html#cb6-36" aria-hidden="true" tabindex="-1"></a>      text_2<span class="op">=</span> pytesseract.image_to_string(ts_2)</span>
<span id="cb6-37"><a href="rename-raw-images.html#cb6-37" aria-hidden="true" tabindex="-1"></a>      match_date_format <span class="op">=</span> re.search(date_pattern,text_2)</span>
<span id="cb6-38"><a href="rename-raw-images.html#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> match_date_format:</span>
<span id="cb6-39"><a href="rename-raw-images.html#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># found timestamp, return</span></span>
<span id="cb6-40"><a href="rename-raw-images.html#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb6-41"><a href="rename-raw-images.html#cb6-41" aria-hidden="true" tabindex="-1"></a>      size_extension<span class="op">+=</span><span class="dv">100</span></span>
<span id="cb6-42"><a href="rename-raw-images.html#cb6-42" aria-hidden="true" tabindex="-1"></a>      loop<span class="op">-=</span><span class="dv">1</span></span>
<span id="cb6-43"><a href="rename-raw-images.html#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="rename-raw-images.html#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loop <span class="op">==</span><span class="dv">0</span>:      </span>
<span id="cb6-45"><a href="rename-raw-images.html#cb6-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reached end of loop without finding correct timestamp</span></span>
<span id="cb6-46"><a href="rename-raw-images.html#cb6-46" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">&quot;Correct timestamp not found&quot;</span>)</span>
<span id="cb6-47"><a href="rename-raw-images.html#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="rename-raw-images.html#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-49"><a href="rename-raw-images.html#cb6-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> match_date_format.group(<span class="dv">0</span>)</span></code></pre></div>
<p>As with before, make sure Google Drive is mounted, and all relevant packages/libraries are
imported. Then, update the file paths<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> and run the main method (below).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="rename-raw-images.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb7-2"><a href="rename-raw-images.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="rename-raw-images.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#collect all folder paths from newly uploaded data on folder</span></span>
<span id="cb7-4"><a href="rename-raw-images.html#cb7-4" aria-hidden="true" tabindex="-1"></a>folder_list <span class="op">=</span> glob(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/Newly_uploaded_data/*/&quot;</span>, recursive <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-5"><a href="rename-raw-images.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># collect all folder path from on deck folder</span></span>
<span id="cb7-6"><a href="rename-raw-images.html#cb7-6" aria-hidden="true" tabindex="-1"></a>folder_list.extend(glob(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/On_Deck/*/&quot;</span>, recursive <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb7-7"><a href="rename-raw-images.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract folder_name </span></span>
<span id="cb7-8"><a href="rename-raw-images.html#cb7-8" aria-hidden="true" tabindex="-1"></a>folder_list <span class="op">=</span> [f[:<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> f <span class="kw">in</span> folder_list]</span>
<span id="cb7-9"><a href="rename-raw-images.html#cb7-9" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-10"><a href="rename-raw-images.html#cb7-10" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/COPY of data for script/Testing destination/file_df.csv&quot;</span>)</span>
<span id="cb7-11"><a href="rename-raw-images.html#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="rename-raw-images.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># for each folder rename and add them to the new destination - dst</span></span>
<span id="cb7-13"><a href="rename-raw-images.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> folder <span class="kw">in</span> folder_list:</span>
<span id="cb7-14"><a href="rename-raw-images.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(i,<span class="st">&quot;/&quot;</span>, <span class="bu">len</span>(folder_list))</span>
<span id="cb7-15"><a href="rename-raw-images.html#cb7-15" aria-hidden="true" tabindex="-1"></a>  i<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb7-16"><a href="rename-raw-images.html#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># destination to save labeled images</span></span>
<span id="cb7-17"><a href="rename-raw-images.html#cb7-17" aria-hidden="true" tabindex="-1"></a>  dst <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/project_dir/labeled_image_files&quot;</span></span>
<span id="cb7-18"><a href="rename-raw-images.html#cb7-18" aria-hidden="true" tabindex="-1"></a>  save_as_zip <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-19"><a href="rename-raw-images.html#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="rename-raw-images.html#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#will unzip if necessary</span></span>
<span id="cb7-21"><a href="rename-raw-images.html#cb7-21" aria-hidden="true" tabindex="-1"></a>  folder, unzipped <span class="op">=</span> unzip_src(folder)</span>
<span id="cb7-22"><a href="rename-raw-images.html#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="rename-raw-images.html#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># #create new destination folder</span></span>
<span id="cb7-24"><a href="rename-raw-images.html#cb7-24" aria-hidden="true" tabindex="-1"></a>  fdr_name, fdr_dst <span class="op">=</span> new_folder(folder, dst)</span>
<span id="cb7-25"><a href="rename-raw-images.html#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="rename-raw-images.html#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> os.path.exists(fdr_dst):</span>
<span id="cb7-27"><a href="rename-raw-images.html#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;path already exists&quot;</span>)</span>
<span id="cb7-28"><a href="rename-raw-images.html#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb7-29"><a href="rename-raw-images.html#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;new path&quot;</span>)</span>
<span id="cb7-30"><a href="rename-raw-images.html#cb7-30" aria-hidden="true" tabindex="-1"></a>    os.mkdir(fdr_dst)</span>
<span id="cb7-31"><a href="rename-raw-images.html#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(folder)</span>
<span id="cb7-32"><a href="rename-raw-images.html#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(fdr_name)</span>
<span id="cb7-33"><a href="rename-raw-images.html#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(fdr_dst)</span>
<span id="cb7-34"><a href="rename-raw-images.html#cb7-34" aria-hidden="true" tabindex="-1"></a>  rename_images(folder, fdr_name, fdr_dst, file_df <span class="op">=</span> file_df)</span></code></pre></div>
<p>The script generates a pandas dataframe which contains the old filename,
new filename, folder name containing the image, as well as the image <strong>status</strong> (whether
or not it was renamed successfully). This dataframe is then exported to a <code>.csv</code> file in a user-specified destination.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="rename-raw-images.html#cb8-1" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.DataFrame(file_names_list, columns <span class="op">=</span> [<span class="st">&quot;old_name&quot;</span>, <span class="st">&quot;new_name&quot;</span>,<span class="st">&quot;status&quot;</span>, <span class="st">&quot;note&quot;</span>,<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb8-2"><a href="rename-raw-images.html#cb8-2" aria-hidden="true" tabindex="-1"></a>file_df.to_csv(dst<span class="op">+</span><span class="st">&quot;/&quot;</span><span class="op">+</span><span class="st">&quot;file_df.csv&quot;</span>)</span>
<span id="cb8-3"><a href="rename-raw-images.html#cb8-3" aria-hidden="true" tabindex="-1"></a>file_df.head()</span></code></pre></div>
<p><img src="imgs/dataframe.png" width="766" /></p>
<div id="manual-renames" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Manual Renames<a href="rename-raw-images.html#manual-renames" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While this script works for the vast majority of images, occasionally some images
will fail to rename correctly. For any files where the timestamp generated a file name
which does not match a valid date, the below chunk of code will identify them.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="rename-raw-images.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in created csv, returns file name and path if extracted timestamp is not in range</span></span>
<span id="cb9-2"><a href="rename-raw-images.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="rename-raw-images.html#cb9-3" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/drive/MyDrive/2_Camera Trap photos/project_dir/labeled_image_files/file_df.csv&quot;</span>)</span>
<span id="cb9-4"><a href="rename-raw-images.html#cb9-4" aria-hidden="true" tabindex="-1"></a>file_df <span class="op">=</span> file_df[file_df[<span class="st">&quot;new_name&quot;</span>].notnull()]</span>
<span id="cb9-5"><a href="rename-raw-images.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> file_df.iterrows():</span>
<span id="cb9-6"><a href="rename-raw-images.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check month range</span></span>
<span id="cb9-7"><a href="rename-raw-images.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">13</span>:<span class="dv">15</span>]) <span class="op">&gt;</span> <span class="dv">12</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">13</span>:<span class="dv">15</span>]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb9-8"><a href="rename-raw-images.html#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Month not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb9-9"><a href="rename-raw-images.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check year range</span></span>
<span id="cb9-10"><a href="rename-raw-images.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">9</span>:<span class="dv">13</span>]) <span class="op">&gt;</span> <span class="dv">2022</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">9</span>:<span class="dv">13</span>]) <span class="op">&lt;</span> <span class="dv">2018</span>:</span>
<span id="cb9-11"><a href="rename-raw-images.html#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Year not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span>
<span id="cb9-12"><a href="rename-raw-images.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check day range</span></span>
<span id="cb9-13"><a href="rename-raw-images.html#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">15</span>:<span class="dv">17</span>]) <span class="op">&gt;</span> <span class="dv">31</span> <span class="kw">or</span> <span class="bu">int</span>(row[<span class="st">&quot;new_name&quot;</span>][<span class="dv">15</span>:<span class="dv">17</span>]) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb9-14"><a href="rename-raw-images.html#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row[<span class="st">&quot;new_name&quot;</span>]<span class="op">+</span><span class="st">&quot; Day not in range, check name in folder :&quot;</span><span class="op">+</span>row[<span class="st">&quot;old_folder&quot;</span>])</span></code></pre></div>
<p>The other common occurence is if the timestamp failed to generate altogether due
to <code>pytesseract.image_to_string</code> failing. This is sometimes unavoidable and requires manual renaming of the file. However, this should not be a frequent occurence due to the built-in
loop in <code>extract_timeStamp</code>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>For more information, see the comments within the script and text blocks in the Jupyter Notebook.<a href="rename-raw-images.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>If you are looking to reduce the script’s runtime, one method
is to remove the loop within <code>extract_timeStamp</code> which searches multiple times for the
correct timestamp if it is not found initially. However, this will increase the number
of files which failed to be renamed correctly.<a href="rename-raw-images.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>It may be a good idea to remove or make a note of any
non-image files within the folder, as these will throw errors.<a href="rename-raw-images.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="selecting-region-of-interest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/henrysun9074/hbwater_cameratrap_pheno/edit/master/01-intro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/henrysun9074/hbwater_cameratrap_pheno/blob/master/01-intro.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
